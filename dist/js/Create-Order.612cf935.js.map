{"version":3,"file":"js/Create-Order.612cf935.js","mappings":"8gBAWA,MAAMA,GAAS,UAiBTC,EAAS,KACbD,EAAOE,IAAI,EAAC,E,uNCvBd,MAAMC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O,+lBCgDA,MAAMH,GAAS,UACTI,GAAQ,UACRC,GAAQ,QAAS,CACnBC,SAAU,GACVC,QAAS,CAAC,EACVC,SAAS,EACTC,QAAS,GACTC,YAAa,KAGjB,IAAI,SACAJ,EAAQ,QACRC,EAAO,QACPC,EAAO,QACPC,EAAO,YACPC,IACA,QAAOL,IAEX,SAAU,KACNM,GAAK,IAGT,MAAMA,EAAOC,UACT,YAAc,CAAEC,QAAS,SAAUC,aAAa,IAEhD,MAAM,UAAEC,EAAS,YAAEL,GAAgBN,EAAMY,MACnCC,EAAeP,EAAcQ,KAAKC,MAAMT,GAAeQ,KAAKC,OAAM,QAAS,iBAGjF,QAAS,cAAeD,KAAKE,UAAUH,IACvC,MAAQI,KAAMC,SAAe,QAAiB,CAAEZ,YAAaO,EAAaM,KAAK,OAC/EC,QAAQC,IAAIH,GACZ,MAAQD,KAAMd,GAAYQ,QAAkB,QAAiBA,SAAmB,UAChFS,QAAQC,IAAIlB,GACPA,GAILF,EAAMC,SAAWgB,EACjBjB,EAAME,QAAUA,EAChB,aALIP,EAAO0B,KAAK,CAAEC,KAAM,YAKZ,EAGVC,EAAoBhB,UACtB,MAAMiB,EAAS,CACXd,UAAWV,EAAME,QAAQQ,UACzBL,YAAaL,EAAMC,SAASwB,KAAIC,GAAQA,EAAKC,eAE3C,KAAEX,SAAe,QAAYQ,IAEnC,QAAS,cAAe,IACxBxB,EAAMI,QAAUY,EAGhBhB,EAAMG,SAAU,GAGdyB,EAAiBrB,MAAOsB,UAEpB,QAAS,CAAEzB,QAASJ,EAAMI,QAAS0B,QAASD,KAClD,OAAM,QACNE,YAAW,KACPpC,EAAO0B,KAAK,CAAEC,KAAM,UAAU,GAC/B,IAAI,EAILU,GAAQ,SAAS,KACnB,IAAIC,EAAM,EAIV,OAHAjC,EAAMC,SAASiC,SAAQR,IACnBO,GAAOP,EAAKS,WAAaT,EAAKU,gBAE3BH,K,yyDC1HX,MAAMnC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O,8LCGO,SAASuC,EAAWb,GACzB,OAAO,SAAW,WAAYA,EAChC,CAEO,SAASc,EAAYd,GAC1B,OAAO,QAAU,WAAYA,EAC/B,CAEO,SAASe,EAAcC,GAC5B,OAAO,cAAa,YAAYA,IAClC,CAEO,SAASC,IACd,OAAO,QAAU,mBACnB,CAEO,SAASC,IACd,OAAO,QAAU,WAAY,CAAEC,WAAY,EAAGC,SAAU,KAC1D,CAEO,SAASC,EAAiBL,GAC/B,OAAO,QAAU,YAAYA,IAC/B,C,sHCtBO,SAASM,EAAYtB,GAC1B,OAAO,SAAW,aAAcA,EAClC,CAEO,SAASuB,EAAavB,GAC3B,OAAO,QAAU,SAAU,CAAEA,UAC/B,CAcO,SAASwB,EAASxB,GACvB,OAAO,QAAU,cAAe,CAAEA,UACpC,C","sources":["webpack://vue3-newbee/./src/components/SimpleHeader.vue","webpack://vue3-newbee/./src/components/SimpleHeader.vue?b208","webpack://vue3-newbee/./src/views/CreateOrder.vue","webpack://vue3-newbee/./src/views/CreateOrder.vue?30a6","webpack://vue3-newbee/./src/service/address.js","webpack://vue3-newbee/./src/service/order.js"],"sourcesContent":["<template>\r\n  <header class=\"simple-header van-hairline--bottom\">\r\n    <i v-if=\"!isback\" class=\"nbicon nbfanhui\" @click=\"goBack\"></i>\r\n    <i v-else>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</i>\r\n    <div class=\"simple-header-name\">{{ name }}</div>\r\n    <i class=\"nbicon nbmore\"></i>\r\n  </header>\r\n</template>\r\n<script setup>\r\nimport { ref, defineProps } from \"vue\";\r\nimport { useRouter } from \"vue-router\";\r\nconst router = useRouter()\r\n\r\ndefineProps({\r\n  name: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n  back: {\r\n    type: String,\r\n    default: ''\r\n  },\r\n  noback: {\r\n    type: Boolean,\r\n    default: false\r\n  }\r\n})\r\n\r\nconst goBack = () => {\r\n  router.go(-1)\r\n}\r\n\r\n</script>\r\n<style lang=\"less\" scoped>\r\n@import \"../common/style/mixin\";\r\n\r\n.simple-header {\r\n  position: fixed;\r\n  top: 0px;\r\n  left: 0;\r\n  z-index: 10000;\r\n  .fj();\r\n  .wh(100%, 44px);\r\n  line-height: 44px;\r\n  padding: 0 10px;\r\n  .boxSizing();\r\n  color: #252525;\r\n  background: #fff;\r\n\r\n  .simple-header-name {\r\n    font-size: 14px;\r\n  }\r\n}\r\n\r\n.block {\r\n  height: 44px;\r\n}\r\n</style>","import script from \"./SimpleHeader.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./SimpleHeader.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./SimpleHeader.vue?vue&type=style&index=0&id=b560eeda&lang=less&scoped=true\"\n\nimport exportComponent from \"D:\\\\网页项目\\\\项目\\\\vue3-newbee\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-b560eeda\"]])\n\nexport default __exports__","<template>\r\n    <s-header :name=\"'生成订单'\" @callback=\"deleteLocal\"></s-header>\r\n    <div class=\"create-order\">\r\n\r\n        <div class=\"address-wrap\">\r\n            <div class=\"name\" @click=\"goTo\">\r\n                <span>{{ address.userName }} </span>\r\n                <span>{{ address.userPhone }}</span>\r\n            </div>\r\n            <div class=\"address\">\r\n                {{ address.provinceName }} {{ address.cityName }} {{ address.regionName }} {{ address.detailAddress }}\r\n            </div>\r\n            <van-icon class=\"arrow\" name=\"arrow\" />\r\n        </div>\r\n        <div class=\"good\">\r\n            <div class=\"good-item\" v-for=\"(item, index) in cartList\" :key=\"index\">\r\n                <div class=\"good-img\"><img :src=\"$filters.prefix(item.goodsCoverImg)\" alt=\"\"></div>\r\n                <div class=\"good-desc\">\r\n                    <div class=\"good-title\">\r\n                        <span>{{ item.goodsName }}</span>\r\n                        <span>x{{ item.goodsCount }}</span>\r\n                    </div>\r\n                    <div class=\"good-btn\">\r\n                        <div class=\"price\">¥{{ item.sellingPrice }}</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"pay-wrap\">\r\n            <div class=\"price\">\r\n                <span>商品金额</span>\r\n                <span>¥{{ total }}</span>\r\n            </div>\r\n            <van-button @click=\"handleCreateOrder\" class=\"pay-btn\" color=\"#1baeae\" type=\"primary\"\r\n                block>生成订单</van-button>\r\n        </div>\r\n        <van-popup closeable :close-on-click-overlay=\"false\" v-model:show=\"showPay\" position=\"bottom\"\r\n            :style=\"{ height: '30%' }\" @close=\"close\">\r\n            <div :style=\"{ width: '90%', margin: '0 auto', padding: '50px 0' }\">\r\n                <van-button :style=\"{ marginBottom: '10px' }\" color=\"#1989fa\" block\r\n                    @click=\"handlePayOrder(1)\">支付宝支付</van-button>\r\n                <van-button color=\"#4fc08d\" block @click=\"handlePayOrder(2)\">微信支付</van-button>\r\n            </div>\r\n        </van-popup>\r\n    </div>\r\n</template>\r\n<script setup>\r\nimport { reactive, onMounted, toRefs, computed } from 'vue';\r\nimport sHeader from \"../components/SimpleHeader.vue\"\r\nimport { getByCartItemIds } from \"../service/cart\"\r\nimport { getAddressDetail, getDefaultAddress } from \"../service/address\"\r\nimport { createOrder, payOrder } from \"../service/order\"\r\nimport { setLocal, getLocal } from '@/common/js/utils';\r\nimport { Toast } from \"vant\"\r\nimport { useRoute, useRouter } from 'vue-router';\r\n\r\nconst router = useRouter()\r\nconst route = useRoute()\r\nconst state = reactive({\r\n    cartList: [],\r\n    address: {},\r\n    showPay: false,\r\n    orderNo: '',\r\n    cartItemIds: []\r\n})\r\n\r\nlet {\r\n    cartList,\r\n    address,\r\n    showPay,\r\n    orderNo,\r\n    cartItemIds\r\n} = toRefs(state)\r\n\r\nonMounted(() => {\r\n    init()\r\n})\r\n\r\nconst init = async () => {\r\n    Toast.loading({ message: \"加载中...\", forbidClick: true })\r\n    // 抽取路由的参数\r\n    const { addressId, cartItemIds } = route.query\r\n    const _cartItemIds = cartItemIds ? JSON.parse(cartItemIds) : JSON.parse(getLocal('cartItemIds'))\r\n    // console.log(cartItemIds);\r\n    // 吧要结算的商品id存入localStorage中\r\n    setLocal('cartItemIds', JSON.stringify(_cartItemIds))\r\n    const { data: list } = await getByCartItemIds({ cartItemIds: _cartItemIds.join(',') })\r\n    console.log(list);\r\n    const { data: address } = addressId ? await getAddressDetail(addressId) : await getDefaultAddress()\r\n    console.log(address);\r\n    if (!address) {\r\n        router.push({ path: '/address' })\r\n        return\r\n    }\r\n    state.cartList = list\r\n    state.address = address\r\n    Toast.clear()\r\n}\r\n\r\nconst handleCreateOrder = async () => {\r\n    const params = {\r\n        addressId: state.address.addressId,\r\n        cartItemIds: state.cartList.map(item => item.cartItemId)\r\n    }\r\n    const { data } = await createOrder(params)\r\n    // console.log('55555' + data);\r\n    setLocal('cartItemIds', '')\r\n    state.orderNo = data\r\n    // console.log(state.orderNo);\r\n    // 弹出支付宝微信\r\n    state.showPay = true\r\n}\r\n\r\nconst handlePayOrder = async (type) => {\r\n    // type使用微信或支付宝支付\r\n    await payOrder({ orderNo: state.orderNo, payType: type })\r\n    Toast('支付成功')\r\n    setTimeout(() => {\r\n        router.push({ path: '/order' })\r\n    }, 2000)\r\n}\r\n\r\n// 商品总价\r\nconst total = computed(() => {\r\n    let sum = 0\r\n    state.cartList.forEach(item => {\r\n        sum += item.goodsCount * item.sellingPrice\r\n    })\r\n    return sum\r\n})\r\n\r\n</script>\r\n<style lang=\"less\" scoped>\r\n@import '../common/style/mixin';\r\n\r\n.create-order {\r\n    background: #f9f9f9;\r\n    margin-top: 50px;\r\n\r\n    .address-wrap {\r\n        margin-bottom: 20px;\r\n        background: #fff;\r\n        position: relative;\r\n        font-size: 14px;\r\n        padding: 15px;\r\n        color: #222333;\r\n\r\n        .name,\r\n        .address {\r\n            margin: 10px 0;\r\n        }\r\n\r\n        .arrow {\r\n            position: absolute;\r\n            right: 10px;\r\n            top: 50%;\r\n            transform: translateY(-50%);\r\n            font-size: 20px;\r\n        }\r\n\r\n        &::before {\r\n            position: absolute;\r\n            right: 0;\r\n            bottom: 0;\r\n            left: 0;\r\n            height: 2px;\r\n            background: -webkit-repeating-linear-gradient(135deg, #ff6c6c 0, #ff6c6c 20%, transparent 0, transparent 25%, #1989fa 0, #1989fa 45%, transparent 0, transparent 50%);\r\n            background: repeating-linear-gradient(-45deg, #ff6c6c 0, #ff6c6c 20%, transparent 0, transparent 25%, #1989fa 0, #1989fa 45%, transparent 0, transparent 50%);\r\n            background-size: 80px;\r\n            content: '';\r\n        }\r\n    }\r\n\r\n    .good {\r\n        margin-bottom: 120px;\r\n    }\r\n\r\n    .good-item {\r\n        padding: 10px;\r\n        background: #fff;\r\n        display: flex;\r\n\r\n        .good-img {\r\n            img {\r\n                .wh(100px, 100px)\r\n            }\r\n        }\r\n\r\n        .good-desc {\r\n            display: flex;\r\n            flex-direction: column;\r\n            justify-content: space-between;\r\n            flex: 1;\r\n            padding: 20px;\r\n\r\n            .good-title {\r\n                display: flex;\r\n                justify-content: space-between;\r\n            }\r\n\r\n            .good-btn {\r\n                display: flex;\r\n                justify-content: space-between;\r\n\r\n                .price {\r\n                    font-size: 16px;\r\n                    color: red;\r\n                    line-height: 28px;\r\n                }\r\n\r\n                .van-icon-delete {\r\n                    font-size: 20px;\r\n                    margin-top: 4px;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    .pay-wrap {\r\n        position: fixed;\r\n        bottom: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        background: #fff;\r\n        padding: 10px 0;\r\n        padding-bottom: 50px;\r\n        border-top: 1px solid #e9e9e9;\r\n\r\n        >div {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            padding: 0 5%;\r\n            margin: 10px 0;\r\n            font-size: 14px;\r\n\r\n            span:nth-child(2) {\r\n                color: red;\r\n                font-size: 18px;\r\n            }\r\n        }\r\n\r\n        .pay-btn {\r\n            position: fixed;\r\n            bottom: 7px;\r\n            right: 0;\r\n            left: 0;\r\n            width: 90%;\r\n            margin: 0 auto;\r\n        }\r\n    }\r\n}\r\n</style>","import script from \"./CreateOrder.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./CreateOrder.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./CreateOrder.vue?vue&type=style&index=0&id=53c5da4f&lang=less&scoped=true\"\n\nimport exportComponent from \"D:\\\\网页项目\\\\项目\\\\vue3-newbee\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-53c5da4f\"]])\n\nexport default __exports__","/**\n * 严肃声明：\n * 开源版本请务必保留此注释头信息，若删除我方将保留所有法律责任追究！\n * 本系统已申请软件著作权，受国家版权局知识产权以及国家计算机软件著作权保护！\n * 可正常分享和学习源码，不得用于违法犯罪活动，违者必究！\n * Copyright (c) 2020 陈尼克 all rights reserved.\n * 版权所有，侵权必究！\n */\n\nimport axios from '../utils/axios'\n\nexport function addAddress(params) {\n  return axios.post('/address', params);\n}\n\nexport function EditAddress(params) {\n  return axios.put('/address', params);\n}\n\nexport function DeleteAddress(id) {\n  return axios.delete(`/address/${id}`);\n}\n\nexport function getDefaultAddress() {\n  return axios.get('/address/default');\n}\n\nexport function getAddressList() {\n  return axios.get('/address', { pageNumber: 1, pageSize: 1000 })\n}\n\nexport function getAddressDetail(id) {\n  return axios.get(`/address/${id}`)\n}\n\n\n","/**\n * 严肃声明：\n * 开源版本请务必保留此注释头信息，若删除我方将保留所有法律责任追究！\n * 本系统已申请软件著作权，受国家版权局知识产权以及国家计算机软件著作权保护！\n * 可正常分享和学习源码，不得用于违法犯罪活动，违者必究！\n * Copyright (c) 2020 陈尼克 all rights reserved.\n * 版权所有，侵权必究！\n */\n\nimport axios from '../utils/axios'\n\nexport function createOrder(params) {\n  return axios.post('/saveOrder', params);\n}\n\nexport function getOrderList(params) {\n  return axios.get('/order', { params });\n}\n\nexport function getOrderDetail(id) {\n  return axios.get(`/order/${id}`);\n}\n\nexport function cancelOrder(id) {\n  return axios.put(`/order/${id}/cancel`);\n}\n\nexport function confirmOrder(id) {\n  return axios.put(`/order/${id}/finish`)\n}\n\nexport function payOrder(params) {\n  return axios.get('/paySuccess', { params })\n}\n\n\n\n\n"],"names":["router","goBack","go","__exports__","route","state","cartList","address","showPay","orderNo","cartItemIds","init","async","message","forbidClick","addressId","query","_cartItemIds","JSON","parse","stringify","data","list","join","console","log","push","path","handleCreateOrder","params","map","item","cartItemId","handlePayOrder","type","payType","setTimeout","total","sum","forEach","goodsCount","sellingPrice","addAddress","EditAddress","DeleteAddress","id","getDefaultAddress","getAddressList","pageNumber","pageSize","getAddressDetail","createOrder","getOrderList","payOrder"],"sourceRoot":""}